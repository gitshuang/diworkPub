"use strict";var _dec,_dec2,_class;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_react2=_interopRequireDefault(_react),_reactDnd=require("react-dnd"),_reactDndHtml5Backend=require("react-dnd-html5-backend"),_reactRedux=require("react-redux"),_utils=require("../utils"),_utils2=require("../../utils");require("./style.css");var _style={add_item:"add_item__style___3ExNW",sider_container:"sider_container__style___6IhSA",toggleBar:"toggleBar__style___1Cm_T",menuListStyle:"menuListStyle__style___2tmSr",card:"card__style___TJQQb",cardLevelFour:"cardLevelFour__style___23gwO",cardLevelThree:"cardLevelThree__style___28iBy",list_item:"list_item__style___3ZqK5",list_item_content:"list_item_content__style___GW5Jo",unSelect:"unSelect__style___2CSzr",isAddColor:"isAddColor__style___3etrI",title_name:"title_name__style___16JSy",iconlocation:"iconlocation__style___3f7Tv",triangle_bottom_right:"triangle_bottom_right__style___361U-",title:"title__style___QeZnm",selectServiceArea:"selectServiceArea__style___1lpsL"},_action=require("../core/action"),_action2=_interopRequireDefault(_action);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var a=Object.getOwnPropertyNames(t),r=0;r<a.length;r++){var i=a[r],c=Object.getOwnPropertyDescriptor(t,i);c&&c.configurable&&void 0===e[i]&&Object.defineProperty(e,i,c)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var updateManageList=_action2.default.updateManageList,updateShadowCard=_action2.default.updateShadowCard,noteSource={beginDrag:function(e,t,a){var r=e.data;r.checked||e.checkedCardList.push(r),e.checkedCardList.forEach(function(e){switch(e.size=1,e.type=3,e.widgetId=e.service.serviceId,e.widgetName=e.service.serviceName,e.serviceCode=e.service.serviceCode,e.icon=e.service.serviceIcon,e.size=e.widgetTemplate?e.widgetTemplate.size:1,e.serviceType=e.widgetTemplate?e.widgetTemplate.serviceType:1,e.size){case 1:e.height=1,e.width=1;break;case 2:e.height=1,e.width=2;break;case 3:e.height=2,e.width=2;break;default:e.height=1,e.width=1}});return e.updateShadowCard({isShadow:!0,width:1,height:1,widgetId:"shadowCardId"}),{id:"shadowCardId",type:"cardList",cardList:e.checkedCardList}},endDrag:function(e,t,a){var r=t.getItem(),i=e.manageList,c=e.updateManageList;t.didDrop()?console.log("正常拖拽"):(i.forEach(function(a){a.children.forEach(function(e,t){e.widgetId==r.id&&a.children.splice(t,1)})}),c(i))},canDrag:function(e,t){var a=e.manageList,r=e.data;return!(0,_utils.hasCardContainInGroups)(a,r.service.serviceCode)}},Card=(_dec=(0,_reactRedux.connect)((0,_utils2.mapStateToProps)("manageList","checkedCardList",{namespace:"managewidget"}),{updateManageList:updateManageList,updateShadowCard:updateShadowCard}))(_class=(_dec2=(0,_reactDnd.DragSource)("item",noteSource,function(e,t){return{connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),isDragging:t.isDragging()}}))(_class=function(t){function a(e){_classCallCheck(this,a);var i=_possibleConstructorReturn(this,t.call(this,e));return i.clickSiderCard=function(){var e=i.props.data,t=e.service.serviceCode,a=e.parentId,r=e.checked;i.props.onChangeChecked(!r,a,t)},i}return _inherits(a,t),a.prototype.componentDidMount=function(){this.props.connectDragPreview((0,_reactDndHtml5Backend.getEmptyImage)(),{captureDraggingState:!0})},a.prototype.shouldComponentUpdate=function(e,t){return e.data.checked!==this.props.data.checked||(0,_utils.hasCardContainInGroups)(this.props.manageList,this.props.data.service.serviceCode)!=(0,_utils.hasCardContainInGroups)(e.manageList,e.data.service.serviceCode)},a.prototype.render=function(){var e=this.props,t=e.connectDragSource,a=e.manageList,r=this.props.data,i=r.service,c=i.serviceName,n=i.serviceCode,s=r.checked,o=(0,_utils.hasCardContainInGroups)(a,n);return t(_react2.default.createElement("div",null,o?_react2.default.createElement("div",{className:"app_col"},_react2.default.createElement("div",{className:_style.list_item_content+" "+_style.title+" "+_style.isAddColor},_react2.default.createElement("span",{className:_style.title_name},c))):_react2.default.createElement("div",{className:"app_col",onClick:this.clickSiderCard},_react2.default.createElement("div",{className:_style.list_item_content+" "+_style.title+" "+(s?"item-checked":null)},_react2.default.createElement("span",{className:_style.title_name,title:c},c),_react2.default.createElement("i",{className:s?"selected":null,style:{color:"rgb(0, 122, 206)"}})))))},a}(_react.Component))||_class)||_class;exports.default=Card,module.exports=exports.default;