"use strict";var _dec,_dec2,_class;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_react2=_interopRequireDefault(_react),_reactDnd=require("react-dnd"),_compact=require("../compact"),_utils=require("../utils"),utilService=_interopRequireWildcard(_utils),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash);require("./style.css");var _style={widgetItem:"widgetItem__style___mMbNU",widgetItemCanDrop:"widgetItemCanDrop__style___2-G4S",widgetItemShadow:"widgetItemShadow__style___hjyMi",widgetFileItem:"widgetFileItem__style___3lAJm",title:"title__style___1-tUD",title_right:"title_right__style___2LXJy",file_title_right:"file_title_right__style___1r-rI",widget_node:"widget_node__style___2-9Tc",content:"content__style___3M3uN",context:"context__style___3Z2m5",bottom:"bottom__style___3vPub",file_context:"file_context__style___206GL",footer:"footer__style___SGOHz",editDele:"editDele__style___36F7U",title_cont:"title_cont__style___1-y3s",edit_cont:"edit_cont__style___2Dn0Q",edit_btn:"edit_btn__style___3Yj6O",title_edit:"title_edit__style___13_BL",clearfix:"clearfix__style___1I0OF",addModule:"addModule__style___1DIhj",widgetList:"widgetList__style___3q80F",pop_dialog_widge_list:"pop_dialog_widge_list__style___1ZNG9",btn:"btn__style___2cocG",card_shadow:"card_shadow__style___10Qyw",card:"card__style___C8z4t",card_mid:"card_mid__style___ugwkR",card_footer:"card_footer__style___1ICvx",card_delete:"card_delete__style___1drZm"},_icon=require("../../icon"),_icon2=_interopRequireDefault(_icon),_reactRedux=require("react-redux"),_util=require("../core/util"),_action=require("../core/action"),_action2=_interopRequireDefault(_action);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),a=0;a<r.length;a++){var _=r[a],i=Object.getOwnPropertyDescriptor(t,_);i&&i.configurable&&void 0===e[_]&&Object.defineProperty(e,_,i)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var updateShadowCard=_action2.default.updateShadowCard,updateGroupList=_action2.default.updateGroupList,noteSource={beginDrag:function(e,t,r){var a=utilService.getCardByGroupIDAndCardID(e.manageList,e.groupID,e.id);return a.isShadow=!0,e.updateShadowCard(a),{id:e.id,type:e.type}},endDrag:function(e,t,r){if(!t.didDrop()){var a=e.manageList;a=_lodash2.default.cloneDeep(a),utilService.setPropertyValueForCards(a,"isShadow",!1),e.updateShadowCard({}),e.updateGroupList(a)}}},Item=(_dec=(0,_reactRedux.connect)((0,_util.mapStateToProps)("manageList","shadowCard","layout",{namespace:"managewidget"}),{updateShadowCard:updateShadowCard,updateGroupList:updateGroupList}))(_class=(_dec2=(0,_reactDnd.DragSource)("item",noteSource,function(e){return{connectDragSource:e.dragSource()}}))(_class=function(t){function r(e){_classCallCheck(this,r);var i=_possibleConstructorReturn(this,t.call(this,e));return i.deleteCard=function(){var e=i.props,t=e.manageList,r=e.groupIndex;t=_lodash2.default.cloneDeep(t),utilService.removeCardByGroupIndexAndCardID(t,r,i.props.id);var a=(0,_compact.compactLayoutHorizontal)(t[r].children,i.props.layout.col);t[r].children=a,i.props.updateGroupList({manageList:t,isEdit:!0})},i.onCheckboxChange=function(e){var t=i.props,r=t.manageList,a=t.groupIndex,_=t.index;(r=_lodash2.default.cloneDeep(r))[a].children[_].isChecked=e,i.props.updateGroupList(r)},i}return _inherits(r,t),r.prototype.shouldComponentUpdate=function(e,t){this.props,this.state;return this.props.isChecked!==e.isChecked||(!_lodash2.default.isEqual(this.props.layout,e.layout)||(this.props.gridx!==e.gridx||this.props.gridy!==e.gridy||this.props.isShadow!==e.isShadow))},r.prototype.render=function(){var e=this.props,t=e.connectDragSource,r=e.name,a=e.gridx,_=e.gridy,i=e.width,o=e.height,d=e.isShadow,l=(e.isChecked,e.haspower),s=this.props.layout,c=s.margin,n=s.rowHeight,u=s.calWidth,p=utilService.calGridItemPosition(a,_,c,n,u),f=p.x,h=p.y,y=utilService.calWHtoPx(i,o,c,n,u),m=y.wPx,g=y.hPx,w=void 0;if(d)w=_react2.default.createElement("div",{className:_style.card_shadow,style:{width:m,height:g,transform:"translate("+f+"px, "+h+"px)"}},_react2.default.createElement("div",{className:"cardTitle"},r),_react2.default.createElement("div",{className:_style.card_footer},_react2.default.createElement(_icon2.default,{type:"dustbin",className:"card-delete",onClick:this.deleteCard})));else{var v=!1===l?.6:1;w=_react2.default.createElement("div",{className:_style.card,style:{width:m,height:g,opacity:v,transform:"translate("+f+"px, "+h+"px)"}},_react2.default.createElement("div",{className:"cardTitle"},r),_react2.default.createElement("div",{className:_style.card_mid}),_react2.default.createElement("div",{className:(_utils.IS_IE?"ie11":"")+" "+_style.card_footer},_react2.default.createElement(_icon2.default,{type:"dustbin",className:"card-delete",onClick:this.deleteCard})))}return t(w)},r}(_react.Component))||_class)||_class;exports.default=Item,module.exports=exports.default;