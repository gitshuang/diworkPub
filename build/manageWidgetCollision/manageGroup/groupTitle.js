"use strict";var _dec,_class;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_react2=_interopRequireDefault(_react),_checkbox=require("../../bee/checkbox"),_checkbox2=_interopRequireDefault(_checkbox),_message=require("../../bee/message"),_message2=_interopRequireDefault(_message),_reactRedux=require("react-redux"),_menus=require("../../bee/menus"),_menus2=_interopRequireDefault(_menus),_dropdown=require("../../bee/dropdown"),_dropdown2=_interopRequireDefault(_dropdown),_button=require("../../button"),_utils=require("../../utils"),_action=require("../core/action"),_action2=_interopRequireDefault(_action),_languages=require("yutils/languages"),_languages2=_interopRequireDefault(_languages),_icon=require("../../icon"),_icon2=_interopRequireDefault(_icon);require("./style.css");var _style={widgetTitle:"widgetTitle__style___2j5oO",addBtn:"addBtn__style___3czkk",addGroupBtn:"addGroupBtn__style___1l9Lk",titleInputArea:"titleInputArea__style___Xn32m",input:"input__style___1SqZ1",newGroupName:"newGroupName__style___3zjlf",newGroupName_focus:"newGroupName_focus__style___c_o_p",newGroupName_blur:"newGroupName_blur__style___3ih13",btn:"btn__style___1XekA",icon:"icon__style___1FLUN",groupArea:"groupArea__style___1r1pI",selectedBackClass:"selectedBackClass__style___X9npf",iconBox:"iconBox__style___3dgJC",widgetTitleInit:"widgetTitleInit__style___1uhzz",check_group:"check_group__style___Dyz8n",noChildStyle:"noChildStyle__style___1LGRc"};function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),a=0;a<r.length;a++){var o=r[a],n=Object.getOwnPropertyDescriptor(t,o);n&&n.configurable&&void 0===e[o]&&Object.defineProperty(e,o,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var addGroup=_action2.default.addGroup,updateGroupList=_action2.default.updateGroupList,selectGroupActions=_action2.default.selectGroupActions,selectListActions=_action2.default.selectListActions,delectGroup=_action2.default.delectGroup,setEditonlyId=_action2.default.setEditonlyId,setDragInputState=_action2.default.setDragInputState,renameGroup=_action2.default.renameGroup,moveBottomGroup=_action2.default.moveBottomGroup,moveTopGroup=_action2.default.moveTopGroup,GroupTitle=(_dec=(0,_reactRedux.connect)((0,_utils.mapStateToProps)("manageList","layout","selectGroup","currEditonlyId","selectList",{namespace:"managewidget"}),{addGroup:addGroup,updateGroupList:updateGroupList,selectGroupActions:selectGroupActions,selectListActions:selectListActions,delectGroup:delectGroup,setEditonlyId:setEditonlyId,setDragInputState:setDragInputState,renameGroup:renameGroup,moveBottomGroup:moveBottomGroup,moveTopGroup:moveTopGroup}))(_class=function(t){function r(e){_classCallCheck(this,r);var d=_possibleConstructorReturn(this,t.call(this,e));return d.renameGroupCancel=function(e){var t=d.props,r=t.renameGroup,a=t.setEditonlyId,o=d.props.data.widgetName,n=d.state.groupName;d.setState({groupName:o||n}),a(""),o||r({index:e,name:n}),d.setState({inFoucs:!1})},d.renameGroupFn=function(e){var t=d.props,r=t.renameGroup,a=t.manageList,o=d.state.groupName;return o==a[e].widgetName?(d.renameGroupCancel(e),!1):a.map(function(e,t){return e.widgetName}).includes(o)?(_message2.default.create({content:_languages2.default.group_name_exists,duration:1.5,position:"topLeft",color:"warning",style:{height:"auto"}}),!1):(r({index:e,name:o}),void d.renameGroupCancel(e))},d.openRenameGroupFn=function(e){(0,d.props.setEditonlyId)(e),setTimeout(function(){d.refs.groupName.focus(),d.refs.groupName.select()},0),d.setState({inFoucs:!1})},d.clearInput=function(){d.setState({groupName:""})},d.editGroupName=function(e){var t=e.target.value;d.setState({groupName:t})},d.handleFocus=function(){d.setState({inFoucs:!0});var e=d.props,t=e.setDragInputState;e.dragState&&t(!1)},d.handleBlur=function(){d.setState({inFoucs:!1});var e=d.props,t=e.setDragInputState;e.dragState||t(!0)},d.selectFn=function(e,r){var t=d.props,a=t.selectListActions,o=t.manageList,n=t.selectList,u=t.selectGroup,l=t.selectGroupActions,c=e,s=o[r].children.map(function(e,t){return e.widgetId});c?(u.push(r),l(u),n=window.ActiveXObject||"ActiveXObject"in window?Array.from(n.concat(s).distinct()):Array.from(new Set(n.concat(s)))):(n=n.filter(function(e){return!s.includes(e)}),l(u.filter(function(e,t){return r!==e})));a(n)},d.moveTopFn=function(e){(0,d.props.moveTopGroup)(e)},d.moveBottomFn=function(e){(0,d.props.moveBottomGroup)(e)},d.delectGroupFn=function(e){(0,d.props.delectGroup)(e)},d.onDropSelect=function(t){return function(e){switch(e.key){case"1":d.moveBottomFn(t);break;case"2":d.moveTopFn(t);break;default:d.delectGroupFn(t)}}},d.renderDrop=function(e){var t=d.props.manageList,r=_react2.default.createElement(_menus2.default,{onClick:d.onDropSelect(e)},e!==t.length-1?_react2.default.createElement(_menus.Item,{key:"1"},_languages2.default.move_down):null,e?_react2.default.createElement(_menus.Item,{key:"2"},_languages2.default.move_up):null,_react2.default.createElement(_menus.Item,{key:"3"},_languages2.default.delete));return _react2.default.createElement(_dropdown2.default,{trigger:["click"],overlay:r,animation:"slide-up"},_react2.default.createElement("div",null,_react2.default.createElement(_icon2.default,{title:_languages2.default.more,type:"more"})))},d.renderTitle=function(){var e=d.props,t=e.data,r=t.widgetId,a=t.widgetName,o=t.children,n=e.currEditonlyId,u=e.groupID,l=e.index,c=e.selectGroup,s=d.state,i=s.inFoucs,_=s.groupName,p=-1<c.indexOf(l);return n==u?_react2.default.createElement("div",{className:_style.widgetTitle},_react2.default.createElement("div",{className:_style.titleInputArea},_react2.default.createElement("input",{className:(i?_style.newGroupName_focus:_style.newGroupName_blur)+" "+_style.newGroupName+" input",value:_,maxLength:"4",autoFocus:"autofocus",onChange:d.editGroupName,onFocus:d.handleFocus,onBlur:d.handleBlur,placeholder:_languages2.default.groupName_max_words_four,ref:"groupName"})),_react2.default.createElement(_button.ButtonCheckSelected,{id:r+"_btn",className:_style.btn,onClick:function(){d.renameGroupFn(l)}},_react2.default.createElement(_icon2.default,{type:"right"})),_react2.default.createElement(_button.ButtonCheckClose,{className:_style.btn,onClick:function(){d.renameGroupCancel(l)}},_react2.default.createElement(_icon2.default,{type:"cancel"}))):_react2.default.createElement("div",{className:_style.widgetTitle+" "+_style.widgetTitleInit+" "},_react2.default.createElement("div",{className:_style.check_group},_react2.default.createElement(_checkbox2.default,{checked:p,onChange:function(e){d.selectFn(e,l)}},a),_languages2.default.noDataGroup&&0===o.length?_react2.default.createElement("span",{className:_style.noChildStyle},_react2.default.createElement(_icon2.default,{type:"notice"}),_languages2.default.noDataGroup):null),_react2.default.createElement("div",null,_react2.default.createElement("div",{className:_style.iconBox},_react2.default.createElement(_icon2.default,{title:_languages2.default.rename_group,type:"record",onClick:function(){d.openRenameGroupFn(u)}})),d.renderDrop(l)))},d.state={groupName:"",inFoucs:!1,showModal:!1,selectGroup:[],selectList:[]},d}return _inherits(r,t),r.prototype.componentWillReceiveProps=function(e){this.props.currEditonlyId!==e.currEditonlyId&&this.props.data.isNew&&(this.props.renameGroup({id:this.props.data.widgetId,name:""==this.state.groupName?this.props.data.widgetName:this.state.groupName,dontChangeCurrEditonlyId:!0}),this.setState({inFoucs:!1}))},r.prototype.render=function(){return _react2.default.createElement("div",null,this.renderTitle())},r}(_react2.default.Component))||_class;exports.default=GroupTitle,module.exports=exports.default;