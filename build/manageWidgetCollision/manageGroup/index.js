"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _dec,_dec2,_dec3,_class,_class2,_temp,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_groupItem=require("./groupItem"),_groupItem2=_interopRequireDefault(_groupItem),_reactDnd=require("react-dnd"),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_pop=require("../../pop"),_pop2=_interopRequireDefault(_pop),_button=require("../../button"),_utils=require("../../utils"),_icon=require("../../icon"),_icon2=_interopRequireDefault(_icon),_checkbox=require("../../bee/checkbox"),_checkbox2=_interopRequireDefault(_checkbox),_manageWidgetItem=require("../manageWidgetItem"),_manageWidgetItem2=_interopRequireDefault(_manageWidgetItem),_utils2=require("../utils"),utilService=_interopRequireWildcard(_utils2),_reactDom=require("react-dom"),_reactRedux=require("react-redux"),_util=require("../core/util"),_action=require("../core/action"),_action2=_interopRequireDefault(_action);require("./style.css");var _style={widgetTitle:"widgetTitle__style___2j5oO",addBtn:"addBtn__style___3czkk",addGroupBtn:"addGroupBtn__style___1l9Lk",titleInputArea:"titleInputArea__style___Xn32m",input:"input__style___1SqZ1",newGroupName:"newGroupName__style___3zjlf",newGroupName_focus:"newGroupName_focus__style___c_o_p",newGroupName_blur:"newGroupName_blur__style___3ih13",btn:"btn__style___1XekA",icon:"icon__style___1FLUN",groupArea:"groupArea__style___1r1pI",selectedBackClass:"selectedBackClass__style___X9npf",iconBox:"iconBox__style___3dgJC",widgetTitleInit:"widgetTitleInit__style___1uhzz",check_group:"check_group__style___Dyz8n",noChildStyle:"noChildStyle__style___1LGRc"};function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),a=0;a<r.length;a++){var o=r[a],n=Object.getOwnPropertyDescriptor(t,o);n&&n.configurable&&void 0===e[o]&&Object.defineProperty(e,o,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var dropSideCards=_action2.default.dropSideCards,dropSideCardsInGroup=_action2.default.dropSideCardsInGroup,setEditonlyId=_action2.default.setEditonlyId,moveBottomGroup=_action2.default.moveBottomGroup,moveTopGroup=_action2.default.moveTopGroup,delectGroup=_action2.default.delectGroup,addGroup=_action2.default.addGroup,renameGroup=_action2.default.renameGroup,selectGroupActions=_action2.default.selectGroupActions,selectListActions=_action2.default.selectListActions,setDragInputState=_action2.default.setDragInputState,itemSource={beginDrag:function(e){return{id:e.id,type:e.type,parentId:e.parentId,index:e.index}}},itemTarget={hover:function(e,t,r){var a=t.getItem();if(1===a.type){var o=t.getItem().index,n=e.index;if(o===n)return;var i=(0,_reactDom.findDOMNode)(r).getBoundingClientRect(),u=(i.bottom-i.top)/2,c=t.getClientOffset().y-i.top;if(o<n&&c<u)return;if(n<o&&u<c)return;e.moveGroupItem(o,n),t.getItem().index=n}else if(3===a.type||"cardList"===a.type){var l=e,s=t.getClientOffset(),d=s.x,p=s.y,_=(0,_reactDom.findDOMNode)(r).getBoundingClientRect(),m=_.left,f=_.top;e.moveCardInGroupItem(a,l,d-m,p-f)}},drop:function(e,t,r){var a=t.getItem(),o=e;1===a.type?e.moveGroupDrag(a.id,e.id):3===a.type?e.onCardDropInGroupItem(a,o):"cardList"===a.type&&e.onCardListDropInGroupItem(a,o)}},ManageGroup=(_dec=(0,_reactRedux.connect)((0,_util.mapStateToProps)("manageList","layout","defaultLayout","currEditonlyId","selectList",{namespace:"managewidget"}),{dropSideCards:dropSideCards,dropSideCardsInGroup:dropSideCardsInGroup,setEditonlyId:setEditonlyId,moveBottomGroup:moveBottomGroup,moveTopGroup:moveTopGroup,delectGroup:delectGroup,addGroup:addGroup,renameGroup:renameGroup,selectGroupActions:selectGroupActions,selectListActions:selectListActions,setDragInputState:setDragInputState}))(_class=(_dec2=(0,_reactDnd.DragSource)("item",itemSource,function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))(_class=(_dec3=(0,_reactDnd.DropTarget)("item",itemTarget,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),getItemType:t.getItem()}}))((_temp=_class2=function(r){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,r.call(this,e));return t.state={groupName:"",inFoucs:!1,showModal:!1,selectGroup:[],selectList:[]},t}return _inherits(a,r),a.prototype.componentWillMount=function(){var a=this,e=this.props,t=e.data,r=t.widgetName,o=t.isNew,n=e.manageList,i=e.languagesJSON;o?setTimeout(function(){var e=n.map(function(e){return e.widgetName}),t=(0,_utils.avoidSameName)(e,i.group);a.setState({groupName:t}),a.groupName.focus(),a.groupName.select();var r=a.props;(0,r.checkFun)(r.currEditonlyId+"_btn")},0):this.setState({groupName:r})},a.prototype.componentDidMount=function(){var e=void 0,t=document.querySelector("#widget-container");t&&(e=t.clientWidth),this.props.layout.containerWidth!==e&&this.props.handleLoad()},a.prototype.componentWillReceiveProps=function(e){this.props.currEditonlyId!==e.currEditonlyId&&this.props.data.isNew&&(this.props.renameGroup({id:this.props.data.widgetId,name:""==this.state.groupName?this.props.data.widgetName:this.state.groupName,dontChangeCurrEditonlyId:!0}),this.setState({inFoucs:!1}))},a.prototype.createCards=function(e,r,a){var o=[];return _.forEach(e,function(e,t){o.push(_react2.default.createElement(_manageWidgetItem2.default,{id:e.widgetId,groupID:r,groupIndex:a,index:t,type:e.type,gridx:e.gridx,gridy:e.gridy,width:e.width,height:e.height,haspower:e.haspower,isShadow:e.isShadow,isChecked:e.isChecked,key:r+"_"+e.widgetId,name:e.widgetName}))}),o},a.prototype.render=function(){var t=this,e=this.props,r=e.manageList,a=e.dragState,o=e.selectGroup,n=e.currEditonlyId,i=e.languagesJSON,u=this.props,c=u.data,l=c.widgetId,s=c.widgetName,d=c.children,p=u.index,_=u.connectDragSource,m=u.connectDropTarget,f=u.isDragging,g=u.cards,y=u.id,h=u.layout,v=u.defaultLayout,G=this.state,I=G.inFoucs,w=G.groupName,N=G.showModal,b=(o.indexOf(p),f?0:1),C=void 0;C=n==l?_react2.default.createElement("div",{className:_style.widgetTitle},_react2.default.createElement("div",{className:_style.titleInputArea},_react2.default.createElement("input",{className:(I?_style.newGroupName_focus:_style.newGroupName_blur)+" "+_style.newGroupName+" input",value:w,maxLength:"4",autoFocus:"autofocus",onChange:this.editGroupName,onFocus:this.handleFocus,onBlur:this.handleBlur,placeholder:i.groupName_max_words_four,ref:function(e){return t.groupName=e}})),_react2.default.createElement(_button.ButtonCheckSelected,{id:l+"_btn",className:_style.btn+" right",onClick:function(){t.renameGroupFn(p)}},_react2.default.createElement(_icon2.default,{type:"Determine"})),_react2.default.createElement(_button.ButtonCheckClose,{className:_style.btn+" error",onClick:function(){t.renameGroupCancel(p)}},_react2.default.createElement(_icon2.default,{type:"error3"}))):_react2.default.createElement("div",{className:_style.widgetTitle+" "+_style.widgetTitleInit+" "},_react2.default.createElement("div",{className:_style.check_group},_react2.default.createElement("div",{className:"titleText"},s),i.noDataGroup&&0===d.length?_react2.default.createElement("span",{className:_style.noChildStyle},_react2.default.createElement(_icon2.default,{type:"notice"}),i.noDataGroup):null),_react2.default.createElement("div",null,_react2.default.createElement("div",{className:_style.iconBox},_react2.default.createElement(_icon2.default,{title:i.rename_group,type:"record",onClick:function(){t.openRenameGroupFn(l)}}),_react2.default.createElement(_icon2.default,{title:i.delete,type:"dustbin",onClick:function(){t.delectGroupFn(p)}}),p?_react2.default.createElement(_icon2.default,{title:i.move_up,font:"shangyi",onClick:function(){t.moveTopFn(p)}}):_react2.default.createElement(_icon2.default,{title:i.move_up,font:"shangyi",className:"disabled",onClick:function(){return!1}}),p!==r.length-1?_react2.default.createElement(_icon2.default,{title:i.move_down,font:"xiayi",onClick:function(){t.moveBottomFn(p)}}):_react2.default.createElement(_icon2.default,{title:i.move_down,font:"xiayi",className:"disabled",onClick:function(){return!1}}))));var D=[{label:""+i.confirm,fun:this.delectGroupFn,className:""},{label:""+i.cancel,fun:this.popClose,className:""}],E=this.props,x=E.isOver,S=E.getItemType,T={};x&&1===S.type&&(T={transform:"scale(1,1)",boxShadow:"0 0 0 3px #ddd,0 0 0 6px #588ce9",borderRadius:"0"});var q=utilService.getContainerMaxHeight(g,h.rowHeight,h.margin),k=_react2.default.createElement("div",{className:_style.groupArea+" animated zoomIn",style:_extends({},T)},_react2.default.createElement("section",{style:_extends({},b),className:I?_style.selectedBackClass:""},C,_react2.default.createElement("div",{id:"widget-container",style:{height:q>v.containerHeight?q:v.containerHeight}},this.createCards(g,y,p))),_react2.default.createElement("div",{className:_style.addBtn},_react2.default.createElement(_button.ButtonDefaultWhite,{className:_style.addGroupBtn,onClick:this.addGroupFn.bind(this,p)},_react2.default.createElement(_icon2.default,{type:"add"}),i.addGroup)),_react2.default.createElement(_pop2.default,{className:"pop_dialog_delete",show:N,type:"delete",close:this.popClose,btns:D,data:{index:p}},_react2.default.createElement("div",{className:"pop_cont"},_react2.default.createElement("span",null,i.confirm_del_this_item))));return a?_(m(k)):k},a}(_groupItem2.default),_class2.propTypes={connectDragSource:_propTypes2.default.func.isRequired,connectDropTarget:_propTypes2.default.func.isRequired,index:_propTypes2.default.number.isRequired,isDragging:_propTypes2.default.bool.isRequired,id:_propTypes2.default.any.isRequired},_class=_temp))||_class)||_class)||_class;exports.default=ManageGroup,module.exports=exports.default;