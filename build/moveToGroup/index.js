"use strict";var _class,_temp;Object.defineProperty(exports,"__esModule",{value:!0});var _react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_button=require("../bee/button"),_button2=_interopRequireDefault(_button),_menus=require("../bee/menus"),_menus2=_interopRequireDefault(_menus),_u=require("@u"),_icon=require("../icon"),_icon2=_interopRequireDefault(_icon),_button3=require("../button");require("../iconfont.js"),require("./style.css");var _style={container:"container__style___3CvgR",title:"title__style___YVWvc",close:"close__style___PWIUk",borderBox:"borderBox__style___1q8V0","u-menu-inline":"u-menu-inline__style___1KbeC","u-menu-selected":"u-menu-selected__style___2rj0p",footer:"footer__style___33izj",selectedli:"selectedli__style___6ub3B",saveBtn:"saveBtn__style___2n4e3",icon:"icon__style___1HXQR"};function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var n=Object.getOwnPropertyNames(t),a=0;a<n.length;a++){var r=n[a],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var Item=_menus2.default.Item,MoveToGroup=(_temp=_class=function(t){function n(e){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,t.call(this,e));return o.setNewGroupName=function(e){var t=e||window.event;o.setState({newGroupName:t.target.value,way:t.target.value})},o.handlerClick=function(e){var t=(0,_u.findPath)(o.props.data,"children","widgetId",e).map(function(e){return e.widgetName}).join("/");o.setState({way:t,selectId:e,inAddGroup:!1})},o.addGroup=function(){var e=o.props,t=e.data,n=e.languagesJSON,a=t.map(function(e){return e.widgetName}),r=(0,_u.avoidSameName)(a,n.group);o.setState({inAddGroup:!0,newGroupName:r}),setTimeout(function(){o.newGroupName.focus(),o.newGroupName.select()},0)},o.confirmAddGroup=function(){o.props.onAddGroup(o.state.newGroupName).then(function(e){var t=e.error,n=e.payload;t||(o.props.onSave(n.widgetId),o.setState({inAddGroup:!1}))})},o.save=function(){var e=o.state,t=e.selectId;e.inAddGroup?o.confirmAddGroup():o.props.onSave(t)},o.cancel=function(){o.props.onCancel()},o.state={newGroupName:"分组",inAddGroup:!1,way:"",selectId:""},o}return _inherits(n,t),n.prototype.makeSelectInterface=function(e,l){var u=this,c=[];return e.forEach(function(e){var t=e.widgetId,n=e.widgetName,a=e.children,r=t===l?_style.selectedli:"";if(a&&a.length)c.push(_react2.default.createElement(_menus.SubMenu,{key:t,classname:r,title:_react2.default.createElement("span",{onClick:function(){u.handlerClick(t)},onKeyDown:function(){u.handlerClick(t)},role:"presentation",style:{display:"block"},className:r},n)},u.makeSelectInterface(a,l)));else{var o=_react2.default.createElement(Item,{key:t,className:r},_react2.default.createElement(_icon2.default,{font:"wenjianjia"}),_react2.default.createElement("span",{style:{display:"block"},onClick:function(){u.handlerClick(t)},onKeyDown:function(){u.handlerClick(t)},role:"presentation"},n));c.push(o)}}),c},n.prototype.render=function(){var t=this,e=this.state,n=e.inAddGroup,a=e.newGroupName,r=e.way,o=e.selectId,l=this.props,u=l.data,c=l.onSave,i=l.onCancel,s=l.onAddGroup,_=l.caller,d=l.languagesJSON;return _react2.default.createElement("div",{className:_style.container},_react2.default.createElement("div",{className:_style.title},_,d.to,"：",r,_react2.default.createElement(_icon2.default,{className:_style.close,type:"error3",onClick:this.cancel})),_react2.default.createElement("div",{className:_style.borderBox},_react2.default.createElement(_menus2.default,{onClick:this.handleClick,style:{width:"100%"},onOpenChange:this.onOpenChange,mode:"inline"},this.makeSelectInterface(u,o)),n?_react2.default.createElement("div",null,_react2.default.createElement("input",{type:"text",ref:function(e){t.newGroupName=e},value:a,onChange:this.setNewGroupName,maxLength:"4"})):null),_react2.default.createElement("div",{className:_style.footer+" um-box-justify",style:{overflow:"hidden"}},s?_react2.default.createElement("div",null,_react2.default.createElement(_button2.default,{style:{float:"left",position:"relative",paddingLeft:16},onClick:this.addGroup,disabled:n},_react2.default.createElement("svg",{className:_style.icon,"aria-hidden":"true"},_react2.default.createElement("use",{xlinkHref:"#icon-xinzeng"})),d.addGroup)):null,_react2.default.createElement("div",{style:{float:"right"}},i?_react2.default.createElement(_button3.ButtonU8cDefault,{onClick:this.cancel},d.cancel):null,c?_react2.default.createElement(_button3.ButtonU8cPrimary,{disabled:!r&&!n,className:_style.saveBtn,onClick:this.save},d.confirm):null)))},n}(_react.Component),_class.propTypes={data:_propTypes2.default.arrayOf(_propTypes2.default.object),onAddGroup:_propTypes2.default.func,onSave:_propTypes2.default.func,onCancel:_propTypes2.default.func,caller:_propTypes2.default.string},_class.defaultProps={data:[],onAddGroup:function(){},onSave:function(){},onCancel:function(){},caller:""},_temp);exports.default=MoveToGroup,module.exports=exports.default;