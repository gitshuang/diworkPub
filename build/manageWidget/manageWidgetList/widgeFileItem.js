"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactRouterDom=require("react-router-dom"),_reactDnd=require("react-dnd"),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes);require("./style.css");var _style={widgetItem:"widgetItem__style___2cyTQ",widgetFileItem:"widgetFileItem__style___tICaL",title:"title__style___zm0G2",title_right:"title_right__style___UBFBm",file_title_right:"file_title_right__style___19Ee7",widget_node:"widget_node__style___ToqKk",content:"content__style___2LRlu",context:"context__style___3qrT9",bottom:"bottom__style___11bvF",file_context:"file_context__style___3J9Fp",footer:"footer__style___1aaeU",editDele:"editDele__style___2JgLz",title_cont:"title_cont__style___1Rfqr",edit_cont:"edit_cont__style___j4ID9",edit_btn:"edit_btn__style___1Gga9",title_edit:"title_edit__style___2H-6e",clearfix:"clearfix__style___3Dpug",addModule:"addModule__style___2YCGI",widgetList:"widgetList__style___3skJU",pop_dialog_widge_list:"pop_dialog_widge_list__style___3h0GN",btn:"btn__style___2hXhq"},_widgetItem=require("./widgetItem"),_widgetItem2=_interopRequireDefault(_widgetItem),_checkbox=require("../../bee/checkbox"),_checkbox2=_interopRequireDefault(_checkbox),_formControl=require("../../bee/form-control"),_formControl2=_interopRequireDefault(_formControl),_button=require("../../bee/button"),_button2=_interopRequireDefault(_button),_pop=require("../../pop"),_pop2=_interopRequireDefault(_pop),_icon=require("../../icon"),_icon2=_interopRequireDefault(_icon),_button3=require("../../button");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),o=0;o<r.length;o++){var n=r[o],i=Object.getOwnPropertyDescriptor(t,n);i&&i.configurable&&void 0===e[n]&&Object.defineProperty(e,n,i)}return e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var type="item",itemSource={beginDrag:function(e){return{id:e.id,parentId:e.parentId,type:e.preType||e.type}}},itemTarget={drop:function(e,t,r){var o=e.moveLine,n=t.getItem().id,i=t.getItem().parentId,a=t.getItem().type,l=t.getItem().folderType,s="center"==o;n!==e.id&&"folder"!==l&&1!==a&&e.moveItemDrag(n,i,a,e.id,e.data.parentId,e.data.type,o,s,e.data)},hover:function(e,t,r){var o=t.getClientOffset(),n=(0,_reactDom.findDOMNode)(r).getBoundingClientRect(),i=n.left-o.x,a=(n.top,o.y,"none");Math.abs(i)<176&&(a=Math.abs(i)<176/3?"left":Math.abs(i)<176/3*2?"center":"right"),(new Date).getTime()%10==0&&e.savePosition(e.id,a)}};function collectSource(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}function collectTaget(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),canDrop:t.canDrop(),getItemType:t.getItem(),offSet:t.getDifferenceFromInitialOffset(),offSet2:t.getClientOffset()}}var WidgeFileItem=function(r){function o(e){_classCallCheck(this,o);var _=_possibleConstructorReturn(this,r.call(this,e));_.fileEdit=function(e){e.stopPropagation();var t=_.props,r=t.setFolderEdit,o=t.data,n=t.setEditonlyId;r(o.widgetId),n(o.widgetId),_.setState({editShow:!0})},_.inputOnChange=function(e){_.setState({value:e})},_.fileDele=function(){_.setState({showModal:!0})},_.save=function(e){_.setState({editShow:!1});var t={id:_.props.data.widgetId,value:_.state.value},r=_.props,o=r.renameFolder,n=r.setEditonlyId;o(t),n("")},_.close=function(e){var t=_.props,r=t.cancelFolderEdit,o=t.setEditonlyId;r(_.props.data.widgetId),_.setState({value:_.props.data.widgetName,editShow:!1}),o("")},_.popSave=function(e){(0,_.props.deleteFolder)(e.widgetId)},_.popClose=function(){_.setState({showModal:!1})},_.isContained=function(e,t){if(!(e instanceof Array&&t instanceof Array))return!1;if(e.length<t.length)return!1;for(var r=e.toString(),o=0,n=t.length;o<n;o++)if(-1==r.indexOf(t[o]))return!1;return!0},_.onHandChange=function(e){var t=_.props,r=t.selectList,o=t.selectGroup,n=t.selectListActions,i=t.selectGroupActions,a=t.propsIndex,l=t.manageList,s=_.props.data.widgetId,c=void 0;if(e){c=[s].concat(_toConsumableArray(r));var d=l[a].children.map(function(e,t){return e.widgetId});_.isContained(c,d)&&(o.push(a),i(o))}else{c=r.filter(function(e,t){return e!==s}),i(o.filter(function(e,t){return a!==e}))}n(c)},_.handleFocus=function(){var e=_.props,t=e.setDragInputState;e.dragState&&t(!1)},_.handleBlur=function(){var e=_.props,t=e.setDragInputState;e.dragState||t(!0)},_.popSave=_.popSave.bind(_),_.popClose=_.popClose.bind(_);var t=!0;return t=!!e.curEditFolderId,_.state={value:e.data.widgetName,editShow:t,showModal:!1,timer:0,timeEnough:!1,position:{},moveLine:"none"},_}return _inherits(o,r),o.prototype.componentDidMount=function(){var e=(0,_reactDom.findDOMNode)(this).getBoundingClientRect();this.setState({position:{x:e.x,y:e.y}})},o.prototype.componentWillReceiveProps=function(e){if(e.curEditFolderId!==this.props.data.widgetId&&this.setState({editShow:!1}),1==e.isOver){var t=(0,_reactDom.findDOMNode)(this).getBoundingClientRect();this.setState({position:{x:t.x,y:t.y}})}var r=this.props,o=(r.canDrop,r.isDragging,r.isOver,r.getItemType);1==e.isOver&&"none"!==e.moveLine?("left"==e.moveLine?this.setState({moveLine:"left",timeEnough:!1}):"center"==e.moveLine?(this.setState({timeEnough:!0}),2!=o.type&&"folder"!=o.folderType||this.setState({moveLine:"none",timeEnough:!1})):this.setState({moveLine:"right",timeEnough:!1}),"dragInFolder"==o.dragType&&this.setState({moveLine:"none",timeEnough:!1}),1===o.type&&this.setState({moveLine:"none",timeEnough:!1})):this.setState({moveLine:"none",timeEnough:!1})},o.prototype.render=function(){var e=this,t=this.props.data,r=t.widgetId,o=this.props,n=o.selectList,i=o.dragState,a=o.languagesJSON,l=-1<n.indexOf(r),s=[{label:a.confirm,fun:this.popSave,className:""},{label:a.cancel,fun:this.popClose,className:""}],c=_react2.default.createElement("div",{className:_style.edit_cont},_react2.default.createElement(_formControl2.default,{className:_style.form_control+" input",value:this.state.value,onChange:this.inputOnChange,onFocus:this.handleFocus,onBlur:this.handleBlur}),_react2.default.createElement(_button3.ButtonCheckSelected,{className:_style.btn,onClick:this.save},_react2.default.createElement(_icon2.default,{type:"right"})),_react2.default.createElement(_button3.ButtonCheckClose,{className:_style.btn,onClick:this.close},_react2.default.createElement(_icon2.default,{type:"cancel"}))),d=_react2.default.createElement("div",{className:_style.clearfix+" "+_style.footer},_react2.default.createElement("div",null,_react2.default.createElement(_checkbox2.default,{className:"test",size:"sm",checked:l,onChange:this.onHandChange})),_react2.default.createElement("div",{className:_style.editDele+" "+_style.clearfix},_react2.default.createElement("div",{onClick:this.fileEdit},_react2.default.createElement(_icon2.default,{title:a.rename_folder,type:"record"})),_react2.default.createElement("div",{onClick:function(){e.popSave(t)}},_react2.default.createElement(_icon2.default,{title:a.delete_folder,type:"dustbin"})))),_=this.props,u=_.connectDragSource,p=_.connectDropTarget,f=_.isDragging,g=_.drag,m=_.isOver,h=_.canDrop,y=(_.offSet,_.offSet2,this.state.position,f?0:1),v={},b={};m&&h&&(this.state.timeEnough&&(v={opacity:"0.7",boxShadow:"0 0 0 5px #ddd,0 0 0 8px rgba(0,205,195,1)",transform:"scale(1.01,1.01)"}),"none"!==this.state.moveLine?("left"==this.state.moveLine&&(b={transform:"scale(1,1)",boxShadow:"-3px 0 0 0 #ddd,-6px 0 0 0 rgba(0,205,195,1)",borderRadius:"0"}),"right"==this.state.moveLine&&(b={transform:"scale(1,1)",boxShadow:"3px 0 0 0 #ddd,6px 0 0 0 rgba(0,205,195,1)",borderRadius:"0"})):b={transform:"scale(1,1)",boxShadow:"0 0 0 0 #ddd,0 0 0 0 #ddd"});var w={backgroundImage:'url("'+this.props.folderBgSrc+'")',backgroundRepeat:"no-repeat"},S=_react2.default.createElement("li",{name:"file",className:_style.widgetItem+" "+_style.widgetFileItem+" animated "+(f?"zoomOut":"zoomIn")+" "+g+" ",style:_extends({},y,b,v,w),onClick:this.props.onClick},_react2.default.createElement("div",{className:_style.title},_react2.default.createElement("div",{className:_style.title_right+" "+_style.file_title_right}," ",t.widgetName," ")),this.props.currEditonlyId==r?c:null,this.props.currEditonlyId==r?null:d,_react2.default.createElement(_pop2.default,{className:"pop_dialog_delete",show:this.state.showModal,type:"delete",close:this.popClose,data:t,btns:s},_react2.default.createElement("div",{className:"pop_cont"},_react2.default.createElement("span",null,a.confirm_delete_service,"[",this.props.data.widgetName,"]?"))));return i?u(p(S)):S},o}(_react.Component);exports.default=(0,_reactDnd.DragSource)(type,itemSource,collectSource)((0,_reactDnd.DropTarget)(type,itemTarget,collectTaget)(WidgeFileItem)),module.exports=exports.default;