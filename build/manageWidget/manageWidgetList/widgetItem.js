"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_reactDnd=require("react-dnd"),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_icon=require("../../icon"),_icon2=_interopRequireDefault(_icon),_checkbox=require("../../bee/checkbox"),_checkbox2=_interopRequireDefault(_checkbox),_pop=require("../../pop"),_pop2=_interopRequireDefault(_pop);require("./style.css");var _style={widgetItem:"widgetItem__style___2cyTQ",widgetFileItem:"widgetFileItem__style___tICaL",title:"title__style___zm0G2",title_right:"title_right__style___UBFBm",file_title_right:"file_title_right__style___19Ee7",widget_node:"widget_node__style___ToqKk",content:"content__style___2LRlu",context:"context__style___3qrT9",bottom:"bottom__style___11bvF",file_context:"file_context__style___3J9Fp",footer:"footer__style___1aaeU",editDele:"editDele__style___2JgLz",title_cont:"title_cont__style___1Rfqr",edit_cont:"edit_cont__style___j4ID9",edit_btn:"edit_btn__style___1Gga9",title_edit:"title_edit__style___2H-6e",clearfix:"clearfix__style___3Dpug",addModule:"addModule__style___2YCGI",widgetList:"widgetList__style___3skJU",pop_dialog_widge_list:"pop_dialog_widge_list__style___3h0GN",btn:"btn__style___2hXhq"};function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),o=0;o<r.length;o++){var i=r[o],n=Object.getOwnPropertyDescriptor(t,i);n&&n.configurable&&void 0===e[i]&&Object.defineProperty(e,i,n)}return e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var timestamp,widgetStyle=[{width:176},{width:360},{width:360,height:360}],type="item",itemSource={beginDrag:function(e,t,r){return timestamp=(new Date).getTime(),window.timestamp=timestamp,{id:e.id,parentId:e.parentId,type:e.preType||e.type,folderType:e.folderType,dragType:e.dragType,props:e}},endDrag:function(e,t,r){return{offSetItem:t.getDifferenceFromInitialOffset()}}},itemTarget={hover:function(e,t,r){var o=e.data.size,i=widgetStyle[o-1].width,n=t.getItem().id;t.getItem().parentId,t.getItem().type,e.id,(new Date).getTime();n!==e.id&&r.setState({drag:"fadeInLeft"});var a=t.getClientOffset(),s=0;r&&(s=(0,_reactDom.findDOMNode)(r).getBoundingClientRect());var l=s.left-a.x,d=(s.top,a.y,"none");Math.abs(l)<i&&(d=Math.abs(l)<i/3?"left":Math.abs(l)<i/3*2?"center":"right"),(new Date).getTime()%10==0&&e.savePosition(e.id,d)},drop:function(e,t,r){var o=e.moveLine,i=t.getItem().id,n=t.getItem().parentId,a=t.getItem().type,s=t.getItem().folderType,l=t.getItem().dragType;if(i!==e.id&&1!==a&&("folder"!==s&&"folder"!==e.folderType||"dragInFolder"===l&&"dragInFolder"==e.dragType)){var d="center"==o;d&&3===a&&3===e.data.type&&"folder"!==s?e.addFolderDrag("",i,n,a,e.id,e.data.parentId,e.data.type,d):e.moveItemDrag(i,n,a,e.id,e.data.parentId,e.data.type,o)}}};function collectSource(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}function collectTaget(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),canDrop:t.canDrop(),offSet:t.getDifferenceFromInitialOffset(),getItemType:t.getItem()}}function getItemStyles(){return{pointerEvents:"none",background:"red"}}var WidgetItem=(_temp=_class=function(t){function r(e){_classCallCheck(this,r);var _=_possibleConstructorReturn(this,t.call(this,e));return _.popSave=function(e){var t=_.props,r=t.deleteFolder,o=t.type,i=t.currGroupIndex,n=t.delectService,a=t.parentId;"pop"===o?n({index:i,folder:a,widgetId:e.widgetId}):r(e.widgetId),_.setState({showModal:!1})},_.popClose=function(){_.setState({showModal:!1})},_.fileDele=function(){_.setState({showModal:!0})},_.isContained=function(e,t){if(!(e instanceof Array&&t instanceof Array))return!1;if(e.length<t.length)return!1;for(var r=e.toString(),o=0,i=t.length;o<i;o++)if(-1==r.indexOf(t[o]))return!1;return!0},_.onHandChange=function(e){var t=_.props,r=t.selectList,o=t.selectGroup,i=t.selectListActions,n=t.selectGroupActions,a=t.propsIndex,s=t.manageList,l=_.props.data.widgetId,d=void 0;if(e){d=[l].concat(_toConsumableArray(r));var c=s[a].children.map(function(e,t){return e.widgetId});_.isContained(d,c)&&(o.push(a),n(o))}else{d=r.filter(function(e,t){return e!==l}),n(o.filter(function(e,t){return a!==e}))}i(d)},_.popSave=_.popSave.bind(_),_.popClose=_.popClose.bind(_),_.state={showModal:!1,title:"",timer:0,timeEnough:!1,moveLine:"none"},_}return _inherits(r,t),r.prototype.componentWillReceiveProps=function(e){var t=this.props,r=(t.canDrop,t.isDragging,t.isOver,t.getItemType),o=t.dragType;1==e.isOver&&"none"!==e.moveLine?("left"==e.moveLine?this.setState({moveLine:"left",timeEnough:!1}):"center"==e.moveLine?(this.setState({timeEnough:!0}),2!=r.type&&"dragInFolder"!=r.dragType||this.setState({moveLine:"none",timeEnough:!1})):this.setState({moveLine:"right",timeEnough:!1}),"dragInFolder"!=r.dragType||o||this.setState({moveLine:"none",timeEnough:!1}),1===r.type&&this.setState({moveLine:"none",timeEnough:!1})):this.setState({moveLine:"none",timeEnough:!1})},r.prototype.render=function(){var e=this,t=this.props.languagesJSON,r=[{label:""+t.confirm,fun:this.popSave,className:""},{label:""+t.cancel,fun:this.popClose,className:""}],o=this.props.data,i=o.widgetId,n=o.size,a=o.widgetName,s=this.props,l=s.connectDragSource,d=s.connectDropTarget,c=s.isDragging,_=s.selectList,p=s.drag,u=c?0:1,f=-1<_.indexOf(i),g=this.props,m=g.isOver,y=g.canDrop,h=(g.offSet,{}),v={};m&&y&&(this.state.timeEnough&&(v={opacity:"0.7",boxShadow:"0 0 0 5px #ddd,0 0 0 8px rgba(0,205,195,1)",transform:"scale(1.01,1.01)",borderRadius:"0"}),"none"!==this.state.moveLine?("left"==this.state.moveLine&&(h={transform:"scale(1,1)",boxShadow:"-3px 0 0 0 #ddd,-6px 0 0 0 rgba(0,205,195,1)",borderRadius:"0"}),"right"==this.state.moveLine&&(h={transform:"scale(1,1)",boxShadow:"3px 0 0 0 #ddd,6px 0 0 0 rgba(0,205,195,1)",borderRadius:"0"})):h={transform:"scale(1,1)",boxShadow:"0 0 0 0 #ddd,0 0 0 0 #ddd"});var b=this.state.title;return l(d(_react2.default.createElement("li",{title:b,className:_style.widgetItem+" "+_style.widget_node+" animated "+(c?"zoomOut":"zoomIn")+" "+p,style:_extends({},widgetStyle[n-1],u,h,v)},_react2.default.createElement("div",{className:b},_react2.default.createElement("div",{className:_style.title_right},a)),_react2.default.createElement("div",{className:_style.widgetItemCont}),_react2.default.createElement("div",{className:_style.clearfix+" "+_style.footer},"pop"==this.props.type?null:_react2.default.createElement(_checkbox2.default,{className:"test",checked:f,onChange:this.onHandChange}),_react2.default.createElement("div",{className:_style.editDele+" "+_style.clearfix},_react2.default.createElement("div",{onClick:function(){e.popSave(e.props.data)}},_react2.default.createElement(_icon2.default,{title:t.deleteService,type:"dustbin"})))),_react2.default.createElement(_pop2.default,{className:"pop_dialog_delete",show:this.state.showModal,type:"delete",close:this.popClose,data:this.props.data,btns:r},_react2.default.createElement("div",{className:"pop_cont"},_react2.default.createElement("span",null,t.confirm_delete_this_service))))))},r}(_react.Component),_class.propTypes={connectDragSource:_propTypes2.default.func.isRequired,connectDropTarget:_propTypes2.default.func.isRequired,isDragging:_propTypes2.default.bool.isRequired},_temp);exports.default=(0,_reactDnd.DragSource)(type,itemSource,collectSource)((0,_reactDnd.DropTarget)(type,itemTarget,collectTaget)(WidgetItem)),module.exports=exports.default;