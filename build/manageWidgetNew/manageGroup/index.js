"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _dec,_dec2,_dec3,_class,_class2,_temp,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_groupItem=require("./groupItem"),_groupItem2=_interopRequireDefault(_groupItem),_reactDnd=require("react-dnd"),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_pop=require("pub-comp/pop"),_pop2=_interopRequireDefault(_pop),_button=require("pub-comp/button"),_u=require("@u"),_icon=require("pub-comp/icon"),_icon2=_interopRequireDefault(_icon),_checkbox=require("../../bee/checkbox"),_checkbox2=_interopRequireDefault(_checkbox),_manageWidgetList=require("../manageWidgetList"),_manageWidgetList2=_interopRequireDefault(_manageWidgetList),_utils=require("../utils"),_reactRedux=require("react-redux"),_actions=require("store/root/manage/actions"),_actions2=_interopRequireDefault(_actions);require("./style.css");var _style={widgetTitle:"widgetTitle__style___2XNZQ",addBtn:"addBtn__style___1X8ee",addGroupBtn:"addGroupBtn__style___WlDlh",titleInputArea:"titleInputArea__style___1zYq0",input:"input__style___1UwF9",newGroupName:"newGroupName__style___1fVPF",newGroupName_focus:"newGroupName_focus__style___1wLJz",newGroupName_blur:"newGroupName_blur__style___1haHz",btn:"btn__style___1rIEA",icon:"icon__style___3_Yw6",groupArea:"groupArea__style___2I1Qe",selectedBackClass:"selectedBackClass__style___14l1x",iconBox:"iconBox__style___1KxJ4",widgetTitleInit:"widgetTitleInit__style___dcWOv",check_group:"check_group__style___1jk6N",noChildStyle:"noChildStyle__style___yNKYo"};function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var a=Object.getOwnPropertyNames(t),r=0;r<a.length;r++){var o=a[r],n=Object.getOwnPropertyDescriptor(t,o);n&&n.configurable&&void 0===e[o]&&Object.defineProperty(e,o,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var dropSideCards=_actions2.default.dropSideCards,dropSideCardsInGroup=_actions2.default.dropSideCardsInGroup,itemSource={beginDrag:function(e){return{id:e.id,type:e.type,parentId:e.parentId}}},itemTarget={hover:function(e,t,a){},drop:function(e,t){var a=t.isOver({shallow:!0}),r=t.getItem().id,o=t.getItem().parentId,n=t.getItem().type,i=e.data.parentId;if(r!==e.id&&1===n&&1===e.data.type)e.moveGroupDrag(r,e.id);else if(3===n&&1===e.data.type){e.data.parentId||(i=e.data.widgetId);var l=(0,_utils.findItemById)(e.data.children,r);(void 0===l||l&&l.widgetId!==r)&&e.moveItemDrag(r,o,n,e.id,i,e.data.type)}else if("cardlist"==n&&1===e.data.type&&a){var s=t.getItem().cardList,c={id:r,preParentId:o,afterId:e.id,parentId:e.data.widgetId,afterType:e.data.type,monitor:t,cardList:s};e.dropSideCardsInGroup(c)}}},ManageGroup=(_dec=(0,_reactRedux.connect)((0,_u.mapStateToProps)("manageList",{namespace:"manage"}),{dropSideCards:dropSideCards,dropSideCardsInGroup:dropSideCardsInGroup}))(_class=(_dec2=(0,_reactDnd.DragSource)("item",itemSource,function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))(_class=(_dec3=(0,_reactDnd.DropTarget)("item",itemTarget,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),getItemType:t.getItem()}}))((_temp=_class2=function(a){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,a.call(this,e));return t.state={groupName:"",inFoucs:!1,showModal:!1,selectGroup:[],selectList:[]},t}return _inherits(r,a),r.prototype.componentWillMount=function(){var r=this,e=this.props,t=e.data,a=t.widgetName,o=t.isNew,n=e.manageList,i=e.languagesJSON;o?setTimeout(function(){var e=n.map(function(e){return e.widgetName}),t=(0,_u.avoidSameName)(e,i.group);r.setState({groupName:t}),r.refs.groupName.focus(),r.refs.groupName.select();var a=r.props;(0,a.checkFun)(a.currEditonlyId+"_btn")},0):this.setState({groupName:a})},r.prototype.componentWillReceiveProps=function(e){this.props.currEditonlyId!==e.currEditonlyId&&this.props.data.isNew&&(this.props.renameGroup({id:this.props.data.widgetId,name:""==this.state.groupName?this.props.data.widgetName:this.state.groupName,dontChangeCurrEditonlyId:!0}),this.setState({inFoucs:!1}))},r.prototype.render=function(){var t=this,e=this.props,a=e.manageList,r=e.dragState,o=e.selectGroup,n=e.currEditonlyId,i=e.applicationsMap,l=e.allServicesByLabelGroup,s=e.getAllServicesByLabelGroup,c=e.setCurrentSelectWidgetMap,u=e.addDesk,d=e.requestSuccess,p=e.requestError,_=e.languagesJSON,m={applicationsMap:i,manageList:a,allServicesByLabelGroup:l,getAllServicesByLabelGroup:s,setCurrentSelectWidgetMap:c,addDesk:u,requestSuccess:d,requestError:p},f=this.props,g=f.data,y=g.widgetId,h=g.widgetName,b=g.children,v=f.index,w=f.connectDragSource,N=f.connectDropTarget,I=f.isDragging,C=this.state,E=C.inFoucs,S=C.groupName,G=C.showModal,D=-1<o.indexOf(v),q=I?0:1,x=void 0;x=n==y?_react2.default.createElement("div",{className:_style.widgetTitle},_react2.default.createElement("div",{className:_style.titleInputArea},_react2.default.createElement("input",{className:(E?_style.newGroupName_focus:_style.newGroupName_blur)+" "+_style.newGroupName+" input",value:S,maxLength:"4",autoFocus:"autofocus",onChange:this.editGroupName,onFocus:this.handleFocus,onBlur:this.handleBlur,placeholder:_.groupName_max_words_four,ref:"groupName"})),_react2.default.createElement(_button.ButtonCheckSelected,{id:y+"_btn",className:_style.btn,onClick:function(){t.renameGroupFn(v)}},_react2.default.createElement(_icon2.default,{type:"right"})),_react2.default.createElement(_button.ButtonCheckClose,{className:_style.btn,onClick:function(){t.renameGroupCancel(v)}},_react2.default.createElement(_icon2.default,{type:"cancel"}))):_react2.default.createElement("div",{className:_style.widgetTitle+" "+_style.widgetTitleInit+" "},_react2.default.createElement("div",{className:_style.check_group},_react2.default.createElement(_checkbox2.default,{checked:D,onChange:function(e){t.selectFn(e,v)}},h),_.noDataGroup&&0===b.length?_react2.default.createElement("span",{className:_style.noChildStyle},_react2.default.createElement(_icon2.default,{type:"notice"}),_.noDataGroup):null),_react2.default.createElement("div",null,_react2.default.createElement("div",{className:_style.iconBox},_react2.default.createElement(_icon2.default,{title:_.rename_group,type:"record",onClick:function(){t.openRenameGroupFn(y)}}),_react2.default.createElement(_icon2.default,{title:_.delete,type:"dustbin",onClick:function(){t.delectGroupFn(v)}}),v?_react2.default.createElement(_icon2.default,{title:_.move_up,type:"move-upward",onClick:function(){t.moveTopFn(v)}}):_react2.default.createElement(_icon2.default,{title:_.move_up,type:"move-upward",className:"disabled",onClick:function(){return!1}}),v!==a.length-1?_react2.default.createElement(_icon2.default,{title:_.move_down,type:"move-down",onClick:function(){t.moveBottomFn(v)}}):_react2.default.createElement(_icon2.default,{title:_.move_down,type:"move-down",className:"disabled",onClick:function(){return!1}}))));var T=[{label:""+_.confirm,fun:this.delectGroupFn,className:""},{label:""+_.cancel,fun:this.popClose,className:""}],k=this.props,B=k.isOver,O=k.getItemType,R={};B&&1===O.type&&(R={transform:"scale(1,1)",boxShadow:"0 0 0 3px #ddd,0 0 0 6px rgba(0,205,195,1)",borderRadius:"0"});var L=_react2.default.createElement("div",{className:_style.groupArea+" animated zoomIn",style:_extends({},R)},_react2.default.createElement("section",{style:_extends({},q),className:E?_style.selectedBackClass:""},x,_react2.default.createElement("div",null,_react2.default.createElement(_manageWidgetList2.default,_extends({index:v,data:b,parentId:this.props.data.widgetId},m,{languagesJSON:_})))),_react2.default.createElement("div",{className:_style.addBtn},_react2.default.createElement(_button.ButtonDefaultWhite,{className:_style.addGroupBtn,onClick:this.addGroupFn.bind(this,v)},_react2.default.createElement(_icon2.default,{type:"add"}),_.addGroup)),_react2.default.createElement(_pop2.default,{className:"pop_dialog_delete",show:G,type:"delete",close:this.popClose,btns:T,data:{index:v}},_react2.default.createElement("div",{className:"pop_cont"},_react2.default.createElement("span",null,_.confirm_del_this_item))));return r?w(N(L)):L},r}(_groupItem2.default),_class2.propTypes={connectDragSource:_propTypes2.default.func.isRequired,connectDropTarget:_propTypes2.default.func.isRequired,index:_propTypes2.default.number.isRequired,isDragging:_propTypes2.default.bool.isRequired,id:_propTypes2.default.any.isRequired},_class=_temp))||_class)||_class)||_class;exports.default=ManageGroup,module.exports=exports.default;