"use strict";var _dec,_class,_class2,_temp,_initialiseProps;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=require("react"),_react2=_interopRequireDefault(_react),_reactRedux=require("react-redux"),_u=require("@u"),_actions=require("store/root/manage/actions"),_actions2=_interopRequireDefault(_actions),_actions3=require("store/root/actions"),_actions4=_interopRequireDefault(_actions3);require("./style.css");var _style={add_item:"add_item__style___33Wyp",sider_container:"sider_container__style___1L4Ic",toggleBar:"toggleBar__style___2EItX",menuListStyle:"menuListStyle__style___13ktw",card:"card__style___3NQiR",cardLevelFour:"cardLevelFour__style___XWUVD",cardLevelThree:"cardLevelThree__style___2vCJy",list_item:"list_item__style___15jnV",list_item_content:"list_item_content__style___3oXP9",unSelect:"unSelect__style___1lSvW",isAddColor:"isAddColor__style___xOtdw",title_name:"title_name__style___yIeE9",iconlocation:"iconlocation__style___28d9d",triangle_bottom_right:"triangle_bottom_right__style___2l_cC",title:"title__style___2S1uq",selectServiceArea:"selectServiceArea__style___3REIN"},_reactTransitionGroup=require("react-transition-group"),_menuList=require("./menuList"),_menuList2=_interopRequireDefault(_menuList),_card=require("./card"),_card2=_interopRequireDefault(_card),_icon=require("pub-comp/icon"),_icon2=_interopRequireDefault(_icon),_utils=require("../utils"),_cardList=require("./cardList"),_cardList2=_interopRequireDefault(_cardList);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var a=r[n],i=Object.getOwnPropertyDescriptor(t,a);i&&i.configurable&&void 0===e[a]&&Object.defineProperty(e,a,i)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var changeSiderState=_actions2.default.changeSiderState,getAllMenuList=_actions2.default.getAllMenuList,updateCheckedCardList=_actions2.default.updateCheckedCardList,requestStart=_actions4.default.requestStart,requestSuccess=_actions4.default.requestSuccess,requestError=_actions4.default.requestError,MySider=(_dec=(0,_reactRedux.connect)((0,_u.mapStateToProps)("isSiderDisplay","manageList","allMenuList","checkedCardList",{namespace:"manage"}),{getAllMenuList:getAllMenuList,requestStart:requestStart,requestSuccess:requestSuccess,requestError:requestError,changeSiderState:changeSiderState,updateCheckedCardList:updateCheckedCardList}))((_temp=_class2=function(r){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,r.call(this,e));return _initialiseProps.call(t),t.state={menuList:[],inputValue:"",isMenuListShow:!1,cardsList:[],keyPath:[],searchValue:""},t}return _inherits(n,r),n.prototype.componentDidMount=function(){var n=this,e=this.props,t=e.getAllMenuList,r=e.requestStart,a=e.requestError,i=e.requestSuccess,s=e.manageList,c=e.roleId;r(),t(c).then(function(e){var t=e.error,r=e.payload;t?a(r):(r.forEach(function(e){e.menuItems.forEach(function(e){e.children.forEach(function(e){e.children.length?e.children.forEach(function(e){(0,_utils.hasCardContainInGroups)(s,e.serviceId)&&(e.hasBeenDragged=!0)}):(0,_utils.hasCardContainInGroups)(s,e.serviceId)&&(e.hasBeenDragged=!0)})})}),n.setState({menuList:r},function(){r.length&&n.showServiceAndChangeInput()}),i())}),this.setHeight(),window.addEventListener("resize",this.setHeight)},n.prototype.componentDidUpdate=function(){this.setHeight()},n.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.setHeight)},n.prototype.componentWillReceiveProps=function(e){console.log(e,"propsprops===============")},n.prototype.render=function(){var t=this,e=this.state,r=e.inputValue,n=(e.searchValue,e.ifSearchState),a=this.props,i=a.isSiderDisplay,s=a.changeSiderState,c=a.languagesJSON;return _react2.default.createElement(_reactTransitionGroup.TransitionGroup,{component:"div",className:_style.sider_container},_react2.default.createElement(_reactTransitionGroup.CSSTransitionGroup,{transitionName:{enter:"animated",enterActive:"fadeInLeft",leave:"animated",leaveActive:"fadeOutLeft"},transitionEnterTimeout:1300,transitionLeaveTimeout:1300},i?_react2.default.createElement("div",null,_react2.default.createElement("div",{className:"sider-container-fixed"},_react2.default.createElement("div",{className:_style.add_item},_react2.default.createElement("span",null,_react2.default.createElement(_icon2.default,{type:"notice"}),c.notice)),n?_react2.default.createElement("div",{className:_style.selectServiceArea},_react2.default.createElement("input",{className:_style.selectService,onKeyUp:this.searchService,key:"clickSearch"}),_react2.default.createElement("span",{onClick:this.switchFetchFn,className:"option"},"取消")):_react2.default.createElement("div",{className:_style.selectServiceArea},_react2.default.createElement("input",{className:_style.selectService,onFocus:function(){t.setState({isMenuListShow:!0})},value:r,key:"menuSearch"}),_react2.default.createElement(_icon2.default,{type:"search",onClick:this.switchFetchFn,className:"option"})),this.renderMenu(),_react2.default.createElement("div",{className:"serviceArea",ref:function(e){return t.serviceArea=e}},this.renderService()))):_react2.default.createElement("div",{style:{width:20}},_react2.default.createElement("i",{className:_style.add_item+" "+_style.toggleBar,style:{position:"fixed"},onClick:s},">"))))},n}(_react.Component),_initialiseProps=function(){var o=this;this.setHeight=function(){o.serviceArea&&(o.serviceArea.style.height=(document.documentElement||document.body).clientHeight-180+"px")},this.renderMenu=function(){var e=o.state,t=e.menuList,r={isMenuListShow:e.isMenuListShow,menuList:t,showServiceAndChangeInput:o.showServiceAndChangeInput};return _react2.default.createElement(_menuList2.default,r)},this.showServiceAndChangeInput=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o.state.keyPath,r="",n=[],e=o.state.menuList;e.length&&(t.length&&e.forEach(function(e){e.menuBarId==t[1]&&(r+=e.menuBarName+"/",e.menuItems.forEach(function(e){if(e.menuItemId==t[0])return r+=e.menuItemName,void(n=e.children)}))}),t.length||(n=e[0].menuItems[0].children,r=e[0].menuBarName+"/"+e[0].menuItems[0].menuItemName),o.setState({cardsList:n,inputValue:r,isMenuListShow:!1,keyPath:t}))},this.renderService=function(){var n=o.props.checkedCardList;return o.state.cardsList.map(function(t,e){if(t.children&&0==t.children.length){var r=n.some(function(e){return e.serviceId==t.serviceId});return t.checked=r,_react2.default.createElement("div",{key:t.menuItemId,className:"result_app_list_3"},_react2.default.createElement(_card2.default,{data:t,key:t.menuItemIdb,index:e,onChangeChecked:o.onChangeChecked}),_react2.default.createElement("hr",null))}return _react2.default.createElement(_cardList2.default,{key:t.menuItemId,list:t.children,listName:t.menuItemName,checkedCardList:n,onChangeChecked:o.onChangeChecked})})},this.onChangeChecked=function(e,t,r){var n=o.state.cardsList,a=o.props,i=a.checkedCardList,s=a.updateCheckedCardList,c=JSON.parse(JSON.stringify(i));e&&n.forEach(function(e){e.menuItemId!=r||e.children.length||c.push(e),e.children.length&&e.children.forEach(function(e){e.menuItemId==r&&c.push(e)})}),e||n.forEach(function(e){e.menuItemId!=r||e.children.length||(c=c.filter(function(e){return e.menuItemId!==r})),e.children.length&&e.children.forEach(function(e){e.menuItemId==r&&(c=c.filter(function(e){return e.menuItemId!==r}))})}),o.setState({cardsList:n}),s(c)},this.searchService=function(e){if(13==e.keyCode){var r=e.target.value,n=[];o.state.menuList.forEach(function(e,t){e.menuItems.forEach(function(e,t){e.children.forEach(function(e,t){0==e.children.length&&-1!=e.menuItemName.indexOf(r)?n.push(e):0!=e.children.length&&e.children.forEach(function(e,t){-1!=e.menuItemName.indexOf(r)&&n.push(e)})})})});var a=[];n.forEach(function(t,e){a.some(function(e){return e.serviceId==t.serviceId})||a.push(t)}),o.setState({cardsList:a})}},this.switchFetchFn=function(){o.setState({ifSearchState:!o.state.ifSearchState,cardsList:[]},function(){o.state.ifSearchState||o.showServiceAndChangeInput()})}},_class=_temp))||_class;exports.default=MySider,module.exports=exports.default;