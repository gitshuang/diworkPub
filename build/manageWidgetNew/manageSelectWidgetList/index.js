"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_buttonGroup=require("../../bee/button-group"),_buttonGroup2=_interopRequireDefault(_buttonGroup),_button=require("../../bee/button"),_button2=_interopRequireDefault(_button),_serviceItem=require("../serviceItem"),_serviceItem2=_interopRequireDefault(_serviceItem),_searchInput=require("pub-comp/searchInput"),_searchInput2=_interopRequireDefault(_searchInput),_button3=require("pub-comp/button"),_u=require("@u");require("./style.css");var _style={select_widget_list:"select_widget_list__style___3nqTE",widget_left:"widget_left__style___qaYvI",widget_right:"widget_right__style___1ruuy",title:"title__style___3LGlM",searchPanel:"searchPanel__style___2xKCl",form_control:"form_control__style___38kVJ",search_icon_con:"search_icon_con__style___3WiPT",panel:"panel__style___2Z7in",panel_left:"panel_left__style___1T0nG",panel_right:"panel_right__style___2w1b4",btn_type:"btn_type__style___3vnB2",server_type:"server_type__style___Vl5ie",footer_btn:"footer_btn__style___31NY7",btn_active:"btn_active__style___3SCGC","u-button-group-vertical":"u-button-group-vertical__style___2w1J3"};function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defaults(e,t){for(var a=Object.getOwnPropertyNames(t),n=0;n<a.length;n++){var r=a[n],i=Object.getOwnPropertyDescriptor(t,r);i&&i.configurable&&void 0===e[r]&&Object.defineProperty(e,r,i)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):_defaults(e,t))}var SelectWidgetList=function(t){function a(e){_classCallCheck(this,a);var s=_possibleConstructorReturn(this,t.call(this,e));return s.btnSearch=function(){var e=s.state.data.applications,t=s.state.value,a=[];a=""==t?e:(t=t.trim(),s.getSearch(e,t)),s.setState({applications:a})},s.getSearch=function(e,r){var i=[];return e.forEach(function(e){if(-1!=(e.applicationName||e.serviceName).indexOf(r)){var t=_extends({},e);e.service&&0<e.service.length&&(t.service=s.getSearch(e.service,r)),i.push(t)}else if(e.service&&0<e.service.length){var a=_extends({},e),n=!(a.service=[]);e.service.forEach(function(e){-1!=e.serviceName.indexOf(r)&&(n=!0,a.service.push(e))}),n&&i.push(a)}}),i},s.onChange=function(t,e){var a=s.state.applications;"1"==t.widgetTemplate.serviceType&&(a.find(function(e){return e.applicationId==t.applicationId}).service.find(function(e){return e.serviceId==t.serviceId}).selected=e);"2"==t.widgetTemplate.serviceType&&(a.find(function(e){return e.applicationId==t.applicationId}).selected=e);var n=!1;a.forEach(function(e,t){if("3"==e.selected)n=!0;else{if(0==e.service.length)return;e.service.find(function(e){return"3"==e.selected})&&(n=!0)}}),s.setState(_extends({},s.state,{edit:n}))},s.inputOnChange=function(e){s.setState({value:e})},s.btnSave=function(){var e=s.state.applications,t=s.props,a=(t.requestError,t.requestSuccess,t.addDesk),n=t.parentId,r=[];e.forEach(function(e,t){"3"==e.selected&&r.push(e),0!=e.service.length&&e.service.forEach(function(e,t){"3"==e.selected&&r.push(e)})}),a({dataList:r,parentId:n}),s.setState({edit:!1}),s.props.close()},s.btnClose=function(){s.props.close()},s.btnTypeClick=function(a){s.state.data.labelGroups.forEach(function(e,t){e.labelGroupName==a.labelGroupName?e.active=!0:e.active=!1}),s.setState(_extends({},s.state))},s.onBtnOnclick=function(t){var a=s.props.applicationsMap,e=s.state,n=e.data,r=e.data.labelGroups,i=[],c=r.find(function(e){return e.active});if(c.labels.forEach(function(e){e.active=!1}),"all"==t.labelId){c.labels.find(function(e){return"all"==e.labelId}).active=!0,i=n.applications}else{var l=c.labels.find(function(e){return e.labelId==t.labelId});l.active=!0,l.appIds.forEach(function(e){i.push(a[e])})}s.setState(_extends({},s.state,{applications:i}))},s.btnUp=function(a){s.state.applications.forEach(function(e,t){e.applicationId==a.applicationId&&(e.extend=!a.extend)}),s.setState(_extends({},s.state.applications))},s.onKeyup=function(e){13===e.keyCode&&s.btnSearch(e)},s.state={data:{},applications:[],value:"",edit:!1},s}return _inherits(a,t),a.prototype.componentDidMount=function(){this.getServices()},a.prototype.getServices=function(){var n=this,e=this.props,r=e.requestError,i=e.requestSuccess,t=e.getAllServicesByLabelGroup,c=e.languagesJSON;t().then(function(e){var t=e.error,a=e.payload;t&&r(a),a.labelGroups.forEach(function(e,t){e.active=0===t,e.labels.splice(0,0,{labelName:c.all,labelId:"all",active:!0})}),n.setState({data:a,applications:a.applications}),i()})},a.prototype.render=function(){var c=this,e=this.state,t=e.data.labelGroups,a=void 0===t?[]:t,n=e.applications,l=this.props.languagesJSON,r=[];a.forEach(function(e,a){var t=e.active,n=e.labels;t&&n.forEach(function(e,t){r.push(_react2.default.createElement(_button2.default,{key:"button_li_"+e.labelId+"-"+a+"-"+t,shape:"border",className:e.active?"active":"",onClick:function(){c.onBtnOnclick(e)}},"     ",e.labelName))})});var s=[];return n.forEach(function(e,t){var a=e.service,n=e.service,r=(n.serviceId,n.serviceName,e.widgetTemplate.serviceType),i=e.extend;"2"==r&&(e.serviceId=e.applicationId,e.serviceName=e.applicationName,e.serviceType="2",e.serviceIcon=e.applicationIcon,e.serviceCode=e.applicationCode,e.widgettemplateId=e.widgetTemplate.widgettemplateId,s.push(_react2.default.createElement(_serviceItem2.default,{key:"widget-title-"+t+"-"+e.serviceId,onChange:c.onChange,data:e,packUp:c.btnUp,arrow:!!(a&&0<a.length),languagesJSON:l}))),e.service.forEach(function(e,t){e.extend=i,s.push(_react2.default.createElement(_serviceItem2.default,{key:"widget-"+(0,_u.guid)(),onChange:c.onChange,data:e,languagesJSON:l}))})}),_react2.default.createElement("div",{className:_style.select_widget_list},_react2.default.createElement("div",{className:_style.widget_right},_react2.default.createElement(_searchInput2.default,{onKeyDown:this.onKeyup,onChange:this.inputOnChange,keywords:this.state.value,onClick:this.btnSearch,placeholder:l.searchContent,btnText:l.search}),_react2.default.createElement("div",{className:_style.panel},_react2.default.createElement("div",{className:_style.panel_left},_react2.default.createElement("div",{className:_style.btn_type},_react2.default.createElement(_buttonGroup2.default,null,a.map(function(e,t){return _react2.default.createElement(_button2.default,{key:"type-"+t,className:e.active?_style.btn_active:null,shape:"border",onClick:function(){c.btnTypeClick(e)}},e.labelGroupName)}))),_react2.default.createElement("div",{className:_style.server_type},_react2.default.createElement(_buttonGroup2.default,{vertical:!0},r))),_react2.default.createElement("div",{className:_style.panel_right},_react2.default.createElement("div",null,s))),_react2.default.createElement("div",{className:_style.footer_btn},this.state.edit?_react2.default.createElement(_button3.ButtonBrand,{onClick:this.btnSave},l.add):_react2.default.createElement(_button3.ButtonBrand,{disabled:!0},l.add),_react2.default.createElement(_button3.ButtonDefaultAlpha,{onClick:this.btnClose},l.cancel))))},a}(_react.Component);exports.default=SelectWidgetList,module.exports=exports.default;